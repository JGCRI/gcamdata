<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prebuilt Data • gcamdata</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Prebuilt Data">
<meta property="og:description" content="gcamdata">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">gcamdata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/getting-started/getting-started.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/driverdrake_vignette.html">driver_drake</a>
    </li>
    <li>
      <a href="../../articles/usermod_vignette.html">User Modification Functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JGCRI/gcamdata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="prebuilt_data_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Prebuilt Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JGCRI/gcamdata/blob/HEAD/vignettes/changing-the-data-system/prebuilt_data.Rmd" class="external-link"><code>vignettes/changing-the-data-system/prebuilt_data.Rmd</code></a></small>
      <div class="hidden name"><code>prebuilt_data.Rmd</code></div>

    </div>

    
    
<p>The GCAM Data System makes use of <a href="https://www.iea.org/statistics/balances/" class="external-link">IEA proprietary data</a> that can’t be publicly posted online (i.e. in this repository). At the same time, GCAM and its data system are public, community models, and we want folks to be able to run them <em>without</em> the IEA data. Additionally, there outputs from the <a href="https://github.com/JGCRI/CEDS" class="external-link">CEDS</a> emissions database are too large to include in this repository. This page describes the solution currently in the data system, how’s it’s implemented, and things to be aware of.</p>
<div class="section level2">
<h2 id="proprietary-data-in-the-gcam-data-system">Proprietary data in the GCAM data system<a class="anchor" aria-label="anchor" href="#proprietary-data-in-the-gcam-data-system"></a>
</h2>
<p>The ‘raw’ (see Note 1 below) IEA data consist of two files: * <code>inst/extdata/energy/en_OECD.csv</code> * <code>inst/extdata/energy/en_nonOECD.csv</code></p>
<p>These are read by a single chunk in the data system, <a href="https://github.com/JGCRI/gcamdata/blob/master/R/zchunk_LA100.IEA_downscale_ctry.R" class="external-link">module_energy_LA100.IEA_downscale_ctry</a>, which combines them and produces its output, the object <code>L100.IEA_en_bal_ctry_hist</code> (energy balances downscaled to 201 countries by iso code, FLOW, PRODUCT, and historical year). This object is used by four chunks immediately downstream:</p>
<ul>
<li><code>module_energy_LA101.en_bal_IEA</code></li>
<li><code>module_energy_LA111.rsrc_fos_Prod</code></li>
<li><code>module_energy_LA118.hydro</code></li>
<li><code>module_energy_LA121.oil</code></li>
</ul>
<p>These each summarize the IEA data and do various operations, collectively producing nine objects that in turn flow to various downstream chunks.</p>
<blockquote>
<p>Note 1: The raw IEA data files used by GCAM are flat file csv exports of the entire IEA energy balances databases. Data starts in 1960 for OECD countries and 1971 for non-OECD countries. Some cleanup of country names was performed to remove non-standard characters.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="what-happens-when-iea-data-are-not-available">What happens when IEA data are not available<a class="anchor" aria-label="anchor" href="#what-happens-when-iea-data-are-not-available"></a>
</h2>
<p>In <code>module_energy_LA100.IEA_downscale_ctry</code>, you’ll see that <code>en_OECD.csv</code> and <code>en_nonOECD.csv</code> are marked as <code>OPTIONAL_FILE</code> inputs (lines 25-26 in <code>zchunk_LA100.IEA_downscale_ctr.R</code>). This is unique in the data system, and means that the data system driver doesn’t error if they’re not found; instead, <code><a href="../../reference/get_data.html">get_data()</a></code> will return NULL if they’re not available. The code checks for this in line 49, and then in lines 305-306 sends a <code><a href="../../reference/missing_data.html">missing_data()</a></code> object back to the driver.</p>
<p>At this point there’s a <code>L100.IEA_en_bal_ctry_hist</code> object, but instead of being a tibble it’s a <code><a href="../../reference/missing_data.html">missing_data()</a></code> object. In each of the four downstream chunks, we check for this condition. E.g. in <code>module_energy_LA101.en_bal_IEA</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>    <span class="cf">if</span>(<span class="kw">is.null</span>(L100.IEA_en_bal_ctry_hist)) {</span>
<span id="cb1-2"><a href="#cb1-2"></a>      <span class="co"># Proprietary IEA energy data are not available, so used saved outputs</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>      L101.en_bal_EJ_R_Si_Fi_Yh_full &lt;-<span class="st"> </span><span class="kw">extract_prebuilt_data</span>(<span class="st">"L101.en_bal_EJ_R_Si_Fi_Yh_full"</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a>      L101.en_bal_EJ_ctry_Si_Fi_Yh_full &lt;-<span class="st"> </span><span class="kw">extract_prebuilt_data</span>(<span class="st">"L101.en_bal_EJ_ctry_Si_Fi_Yh_full"</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a>      L101.in_EJ_ctry_trn_Fi_Yh &lt;-<span class="st"> </span><span class="kw">extract_prebuilt_data</span>(<span class="st">"L101.in_EJ_ctry_trn_Fi_Yh"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>      L101.in_EJ_ctry_bld_Fi_Yh &lt;-<span class="st"> </span><span class="kw">extract_prebuilt_data</span>(<span class="st">"L101.in_EJ_ctry_bld_Fi_Yh"</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a>    } <span class="cf">else</span> {</span></code></pre></div>
<p>So, if the IEA data aren’t available, we load (from the internal package data object) the chunk’s outputs and send them back to the driver. These cached or <em>prebuilt</em> data are saved in a binary format and thus guaranteed to be bit-for-bit identical to what we would have produced, had the IEA data been available.</p>
<p><strong>Important point</strong>: when <code>module_energy_LA101.en_bal_IEA</code> and its kin ‘really’ generate their data, i.e. when the IEA data are available, they confirm that these objects match the cached versions exactly. If not, a warning is issued.</p>
<p>This seems like a lot of work. Why didn’t we simply cache the IEA data itself?** Because it’s proprietary, and we can’t post it to GitHub, even in a binary format. We <em>can</em>, however, cache the one-step-downstream summarized objects.</p>
<p>In summary, through this mechanism the data system will produce numerically identical outputs, regardless of whether the proprietary IEA data are present or not. The only difference (but see Note 2 below) will be that some objects will be tagged with an additional comment: "** PRE-BUILT; RAW IEA DATA NOT AVAILABLE **".</p>
<p>You can access the package’s prebuilt data via <code>gcamdata:::PREBUILT_DATA</code>.</p>
<blockquote>
<p>Note 2: Distributing pre-aggregated data effectively hard-wires the country-to-region mapping; that is, without the proprietary data, users do not have the capability to adjust the country-to-region mapping files (to construct different model regions) or change the mapping from IEA’s sectors and fuels to GCAM’s sectors and fuels.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="what-to-do-if-you-change-something">What to do if you change something<a class="anchor" aria-label="anchor" href="#what-to-do-if-you-change-something"></a>
</h2>
<p>If you change how any of these early-stage chunks (the one that initially handles <code>en_OECD.csv</code> and <code>en_nonOECD.csv</code>, or its immediate downstream dependents) work, you’ll need to follow several steps: 1. If you’re working with these chunks, you <em>must have the proprietary data installed</em>. Otherwise, the system will use its cached data and ignore your code changes. 2. Your changed chunk will be issuing a warning about a mismatch between its output(s) and the prebuilt data, so re-run <a href="https://github.com/JGCRI/gcamdata/blob/master/data-raw/generate_package_data.R" class="external-link">generate_package_data.R</a>. This updates the internal package data, in particular the <code>PREBUILT_DATA</code> object that the <code><a href="../../reference/extract_prebuilt_data.html">extract_prebuilt_data()</a></code> calls above use. Note that if you’re adding a <em>new</em> chunk that uses IEA data, you’ll need to add its output(s) here. 3. Rebuild the package. The driver should now run without warnings. 4. The oldnew test will be failing. Update the <a href="https://github.com/JGCRI/gcamdata.compdata" class="external-link">gcamdata.compdata</a> package by copying your changed output(s) (from <code>./outputs</code> into the corresponding folder in <code>gcamdata.compdata</code>, and then re-running its <code>update-compdata.R</code> script. Rebuild <code>gcamdata.compdata</code>. 5. Best practice: confirm that the driver runs and all tests pass both <em>with</em> and <em>without</em> the proprietary data.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Russell Horowitz, Ben Bond-Lamberty, Katherine Calvin, Ryna Cui, Kalyn Dorheim, Leyang Feng, Jill Horing, Page Kyle, Robert Link, Pralit Patel, Christopher Roney, Abigail Snyder, Aaron Staniszweski, Sean Turner, Matthew Binsted, Zarrar Khan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
