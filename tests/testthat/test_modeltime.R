# Test the `modeltime` function(s)

context("modeltime")

library(tibble)
library(readr)


test_that("DECLARE and MAKE names match", {
  mtnames <- module_modeltime_L200.modeltime(driver.DECLARE_OUTPUTS)
  mtdata <- module_modeltime_L200.modeltime(driver.MAKE)
  expect_equal(sort(mtnames), sort(names(mtdata)))
})

test_that("matches old data system output", {
  mtdata <- module_modeltime_L200.modeltime(driver.MAKE)
  expect_is(mtdata, "list")

  # For each named element in `mtdata`, load corresponding dataset
  # generated by the old data system and compare
  for(i in names(mtdata)) {
    f <- file.path("comparison_data", paste(i, "csv", sep = "."))
    expect_true(file.exists(f), label = paste0(f, "doesn't exist"))

    d <- read_csv(f, skip = 4)
    expect_equivalent(mtdata[[i]], d, label = paste(i, "doesn't match", f))
  }
})
